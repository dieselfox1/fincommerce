(()=>{"use strict";const e=window.wp.blocks,t=window.wp.data,o=window.wp.editor,r=window.wc.wcTypes;class i{blocks=new Map;initialized=!1;attemptedRegisteredBlocks=new Set;constructor(){this.initializeSubscriptions()}static getInstance(){return i.instance||(i.instance=new i),i.instance}parseTemplateId(e){const t=(0,r.isNumber)(e)?void 0:e;return t?.split("//")[1]}initializeSubscriptions(){if(this.initialized)return;const e=(0,t.subscribe)((()=>{const r=(0,t.select)(o.store);if(!r)return;const i=r.getCurrentPostType();if(i)if("post"===i||"page"===i)e(),this.blocks.forEach((e=>{if(e.isAvailableOnPostEditor){const t=e.variationName||e.blockName;this.hasAttemptedRegistration(t)||this.registerBlock(e)}})),this.initialized=!0;else{e();const i=r.getCurrentPostId();this.currentTemplateId="string"==typeof i?this.parseTemplateId(i):void 0,this.handleTemplateChange(void 0),(0,t.subscribe)((()=>{const e=this.currentTemplateId;this.currentTemplateId=this.parseTemplateId(r.getCurrentPostId()),e!==this.currentTemplateId&&this.handleTemplateChange(e)}),o.store),this.initialized=!0}}))}handleTemplateChange(e){(this.currentTemplateId?.includes("single-product")||e?.includes("single-product"))&&this.blocks.forEach((e=>{this.unregisterBlock(e),this.registerBlock(e)}))}hasAttemptedRegistration(e){return this.attemptedRegisteredBlocks.has(e)}unregisterBlock(t){const{blockName:o,isVariationBlock:r,variationName:i}=t;try{r&&i?((0,e.unregisterBlockVariation)(o,i),this.attemptedRegisteredBlocks.delete(i)):((0,e.unregisterBlockType)(o),this.attemptedRegisteredBlocks.delete(o))}catch(e){console.debug(`Failed to unregister block ${o}:`,e)}}registerBlock(o){const{blockName:i,settings:s,isVariationBlock:l,variationName:c,isAvailableOnPostEditor:n}=o;try{const o=c||i;if(this.hasAttemptedRegistration(o))return;const a=(0,t.select)("core/edit-site");if(!a&&!n)return;if(l)(0,e.registerBlockVariation)(i,s);else{const t=(0,r.isEmpty)(s?.ancestor)?["fincommerce/single-product"]:s?.ancestor,o=a&&this.currentTemplateId?.includes("single-product");(0,e.registerBlockType)(i,{...s,ancestor:o?void 0:t})}this.attemptedRegisteredBlocks.add(o)}catch(e){console.error(`Failed to register block ${i}:`,e)}}registerBlockConfig(e){const t=e.variationName||e.blockName;this.blocks.set(t,e),this.registerBlock(e)}}const s=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fincommerce/product-gallery","title":"Product Gallery (Beta)","description":"Showcase your products relevant images and media.","category":"fincommerce","keywords":["FinCommerce"],"supports":{"align":true,"interactivity":true,"layout":{"default":{"type":"flex","flexWrap":"nowrap","orientation":"horizontal"},"allowOrientation":true,"allowEditing":true,"allowJustification":false}},"textdomain":"fincommerce","usesContext":["postId"],"providesContext":{"hoverZoom":"hoverZoom","fullScreenOnClick":"fullScreenOnClick"},"ancestor":["fincommerce/single-product"],"attributes":{"hoverZoom":{"type":"boolean","default":true},"fullScreenOnClick":{"type":"boolean","default":true}},"viewScript":"wc-product-gallery-frontend","example":{},"viewScriptModule":"fincommerce/product-gallery","style":"file:../fincommerce/product-gallery-style.css"}'),l=window.wp.blockEditor,c=window.wc.wcBlocksSharedHocs,n=window.wp.components,a=window.wp.i18n,d=window.ReactJSXRuntime,m=({attributes:e,setAttributes:t})=>{const{hoverZoom:o,fullScreenOnClick:r}=e;return(0,d.jsx)(l.InspectorControls,{children:(0,d.jsxs)(n.PanelBody,{title:(0,a.__)("Media Settings","fincommerce"),children:[(0,d.jsx)(n.ToggleControl,{label:(0,a.__)("Zoom while hovering","fincommerce"),help:(0,a.__)("While hovering the large image will zoom in by 30%.","fincommerce"),checked:o,onChange:()=>t({hoverZoom:!o})}),(0,d.jsx)(n.ToggleControl,{label:(0,a.__)("Open pop-up when clicked","fincommerce"),help:(0,a.__)("Clicking on the large image will open a full-screen gallery experience.","fincommerce"),checked:r,onChange:()=>t({fullScreenOnClick:!r})})]})})},u=[["fincommerce/product-gallery-thumbnails"],["fincommerce/product-gallery-large-image",{},[["fincommerce/product-image",{showProductLink:!1,showSaleBadge:!1}],["fincommerce/product-sale-badge",{align:"right"}],["fincommerce/product-gallery-large-image-next-previous"]]]];(e=>{const t=e.name;if(!t)return void console.error("registerProductBlockType: Block name is required for registration");const o=(({name:e,...t})=>t)(e),{isVariationBlock:r,variationName:s,isAvailableOnPostEditor:l,...c}={...o,...{isAvailableOnPostEditor:!0}||{}},n={blockName:t,settings:{...c},isVariationBlock:null!=r&&r,variationName:null!=s?s:void 0,isAvailableOnPostEditor:null!=l&&l};i.getInstance().registerBlockConfig(n)})({...s,icon:()=>(0,d.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,d.jsx)("path",{d:"M19 3H5C4.4 3 4 3.4 4 4V11C4 11.5 4.4 12 5 12H19C19.5 12 20 11.6 20 11V4C20 3.4 19.6 3 19 3ZM5.5 10.5V10.1L7.3 8.8L8.6 9.6C8.9 9.8 9.3 9.8 9.5 9.5L11 8.1L13.4 10.5H5.5ZM18.5 10.5H15.6L11.6 6.5C11.3 6.2 10.8 6.2 10.5 6.5L8.9 8L7.7 7.2C7.4 7 7.1 7 6.8 7.2L5.5 8.2V4.5H18.5V10.5Z",fill:"currentColor"}),(0,d.jsx)("rect",{x:"4.75",y:"15.5",width:"5",height:"4.5",rx:"1",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),(0,d.jsx)("rect",{x:"12.25",y:"15.5",width:"5",height:"4.5",rx:"1",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})]}),edit:(0,c.withProductDataContext)((({attributes:e,setAttributes:t})=>{const o=(0,l.useBlockProps)({className:"wc-block-product-gallery"});return(0,d.jsxs)("div",{...o,children:[(0,d.jsx)(l.InspectorControls,{children:(0,d.jsx)(m,{attributes:e,setAttributes:t})}),(0,d.jsx)(l.InnerBlocks,{allowedBlocks:["fincommerce/product-gallery-large-image","fincommerce/product-gallery-thumbnails"],template:u})]})})),save:()=>{const e=l.useBlockProps.save({className:"wc-block-product-gallery"}),t=l.useInnerBlocksProps.save(e);return(0,d.jsx)("div",{...t})}}),((this.wc=this.wc||{}).blocks=this.wc.blocks||{})["product-gallery"]={}})();