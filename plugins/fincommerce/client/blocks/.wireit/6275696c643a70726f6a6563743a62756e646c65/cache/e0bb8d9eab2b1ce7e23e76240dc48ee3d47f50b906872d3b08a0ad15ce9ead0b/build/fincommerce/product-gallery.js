import*as e from"@wordpress/interactivity";var t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const o=(g={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store,withScope:()=>e.withScope},u={},t.d(u,g),u),r=e=>{if(!e)return{top:!1,bottom:!1,left:!1,right:!1};const{scrollTop:t,scrollHeight:o,clientHeight:r,scrollLeft:n,scrollWidth:c,clientWidth:i}=e;return{top:t>3,bottom:t+r<o-3,left:n>3,right:n+i<c-3}},n="I acknowledge that using a private store means my plugin will inevitably break on the next store release.",c=e=>(0,o.getContext)(e),{state:i}=(0,o.store)("fincommerce/product-data",{},{lock:n}),{state:s}=(0,o.store)("fincommerce",{},{lock:n}),a={state:{get imageIndex(){const{imageData:e,selectedImageId:t}=c();return e.indexOf(t)}},actions:{selectImage:e=>{const t=c(),{imageData:r}=t,n=r[e],{isDisabledPrevious:i,isDisabledNext:s}={isDisabledPrevious:0===(a=e),isDisabledNext:a===r.length-1};var a;t.isDisabledPrevious=i,t.isDisabledNext=s,t.selectedImageId=n,-1!==n&&((e=>{if(!e)return;const t=(0,o.getElement)()?.ref;if(!t)return;const r=t.closest(".wp-block-fincommerce-product-gallery");if(!r)return;const n=r.querySelector(".wc-block-product-gallery-large-image__container");if(!n)return;const c=n.querySelector(`img[data-image-id="${e}"]`);if(c){const e=n.getBoundingClientRect(),t=c.getBoundingClientRect(),o=n.scrollLeft+(t.left-e.left)-(e.width-t.width)/2;n.scrollTo({left:o,behavior:"smooth"})}})(n),(e=>{if(!e)return;const t=(0,o.getElement)()?.ref;if(!t)return;const r=t.closest(".wp-block-fincommerce-product-gallery");if(!r)return;const n=r.querySelector(`.wc-block-product-gallery-thumbnails__thumbnail img[data-image-id="${e}"]`);if(!n)return;const c=n.closest(".wc-block-product-gallery-thumbnails__scrollable");if(!c)return;const i=n.closest(".wc-block-product-gallery-thumbnails__thumbnail");if(!i)return;const s=c.getBoundingClientRect(),a=i.getBoundingClientRect(),l=c.scrollTop+(a.top-s.top)-(s.height-a.height)/2,g=c.scrollLeft+(a.left-s.left)-(s.width-a.width)/2;c.scrollTo({top:l,left:g,behavior:"smooth"})})(n))},selectCurrentImage:e=>{e&&e.stopPropagation();const t=(0,o.getElement)()?.ref;if(!t)return;const r=t.getAttribute("data-image-id");if(!r)return;const n=parseInt(r,10),{imageData:i}=c(),s=i.indexOf(n);l.selectImage(s)},selectNextImage:e=>{e&&e.stopPropagation();const{imageData:t,selectedImageId:o}=c(),r=t.indexOf(o),n=Math.min(t.length-1,r+1);l.selectImage(n)},selectPreviousImage:e=>{e&&e.stopPropagation();const{imageData:t,selectedImageId:o}=c(),r=t.indexOf(o),n=Math.max(0,r-1);l.selectImage(n)},onSelectedLargeImageKeyDown:e=>{"Enter"!==e.code&&"Space"!==e.code&&"NumpadEnter"!==e.code||("Space"===e.code&&e.preventDefault(),l.openDialog()),"ArrowRight"===e.code&&l.selectNextImage(),"ArrowLeft"===e.code&&l.selectPreviousImage()},onDialogKeyDown:e=>{if("Escape"===e.code&&l.closeDialog(),"Tab"===e.code){const t='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])',r=(0,o.getElement)()?.ref,n=r.querySelectorAll(t);if(!n.length)return;const c=n[0],i=n[n.length-1];if(!e.shiftKey&&e.target===i)return e.preventDefault(),void c.focus();if(e.shiftKey&&e.target===c)return e.preventDefault(),void i.focus();e.target===r&&(e.preventDefault(),c.focus())}},openDialog:()=>{c().isDialogOpen=!0,document.body.classList.add("wc-block-product-gallery-dialog-open")},closeDialog:()=>{c().isDialogOpen=!1,document.body.classList.remove("wc-block-product-gallery-dialog-open")},onTouchStart:e=>{const t=c(),{clientX:o}=e.touches[0];t.touchStartX=o,t.touchCurrentX=o,t.isDragging=!0},onTouchMove:e=>{const t=c();if(!t.isDragging)return;const{clientX:o}=e.touches[0];t.touchCurrentX=o;const r=o-t.touchStartX;Math.abs(r)>10&&e.preventDefault()},onTouchEnd:()=>{const e=c();if(!e.isDragging)return;const t=e.touchCurrentX-e.touchStartX,r=(0,o.getElement)()?.ref,n=r?.offsetWidth||0;Math.abs(t)>.2*n&&(t>0&&!e.isDisabledPrevious?l.selectPreviousImage():t<0&&!e.isDisabledNext&&l.selectNextImage()),e.isDragging=!1,e.touchStartX=0,e.touchCurrentX=0},onScroll:()=>{const e=(0,o.getElement)()?.ref;if(!e)return;const t=c(),n=r(e);t.thumbnailsOverflow=n},onArrowsKeyDown:e=>{"ArrowRight"===e.code&&(e.preventDefault(),l.selectNextImage()),"ArrowLeft"===e.code&&(e.preventDefault(),l.selectPreviousImage())},onThumbnailsArrowsKeyDown:e=>{l.onArrowsKeyDown(e);const t=(0,o.getElement)()?.ref,{selectedImageId:r}=c();if(t){const e=t.closest(".wp-block-fincommerce-product-gallery");if(e){const t=e.querySelector(`img[data-image-id="${r}"]`);t&&t.focus({preventScroll:!0})}}},onClickPrevious:e=>{l.selectPreviousImage(e)},onClickNext:e=>{l.selectNextImage(e)},onKeyDownPrevious:e=>{l.onArrowsKeyDown(e)},onKeyDownNext:e=>{l.onArrowsKeyDown(e)}},callbacks:{listenToProductDataChanges:()=>{const e=i?.productId;if(!e)return;const t=s?.products?.[e]?.variations?.[i?.variationId||0]||s?.products?.[e],o=t?.image_id;if(!o)return;const{imageData:r}=c(),n=r.indexOf(o);n>=0&&l.selectImage(n)},watchForChangesOnAddToCartForm:()=>{const e=c(),t=document.querySelector(`form[data-product_id="${e.productId}"]`);if(!t)return;const r=()=>(0,o.withScope)((()=>l.selectImage(0))),n=new MutationObserver((0,o.withScope)((function(e){for(const t of e){const{imageData:e}=c(),o=t.target.getAttribute("current-image"),r=o?parseInt(o,10):null;if("attributes"===t.type&&r&&e.includes(r)){const t=e.indexOf(r);l.selectImage(t)}else l.selectImage(0)}})));n.observe(t,{attributes:!0});const i=document.querySelector(".wp-block-add-to-cart-form .reset_variations");return i&&i.addEventListener("click",r),()=>{n.disconnect(),document.removeEventListener("click",r)}},dialogStateChange:()=>{const{selectedImageId:e,isDialogOpen:t}=c(),{ref:r}=(0,o.getElement)()||{};if(t&&r instanceof HTMLElement){r.focus();const t=r.querySelector(`[data-image-id="${e}"]`);t instanceof HTMLElement&&t.scrollIntoView({behavior:"auto",block:"center"})}},toggleActiveThumbnailAttributes:()=>{const e=(0,o.getElement)()?.ref;if(!e)return!1;const t=e.getAttribute("data-image-id");if(!t)return!1;const{selectedImageId:r}=c();r===Number(t)?(e.classList.add("wc-block-product-gallery-thumbnails__thumbnail__image--is-active"),e.setAttribute("tabIndex","0")):(e.classList.remove("wc-block-product-gallery-thumbnails__thumbnail__image--is-active"),e.setAttribute("tabIndex","-1"))},initResizeObserver:()=>{const e=(0,o.getElement)()?.ref;if(!e)return;const t=c(),n=new ResizeObserver((()=>{const o=r(e);t.thumbnailsOverflow=o}));return n.observe(e),e.parentElement&&n.observe(e.parentElement),()=>{n.disconnect()}},hideGhostOverflow:()=>{const e=(0,o.getElement)()?.ref;if(!e)return;const{clientWidth:t,scrollWidth:r}=e;t>=r&&(e.style.scrollbarWidth="none")}}},{actions:l}=(0,o.store)("fincommerce/product-gallery",a,{lock:!0});var g,u;