jQuery(function(a){"use strict";var i={init:function(){a("#variable_product_options").on("change","input.variable_is_downloadable",this.variable_is_downloadable).on("change","input.variable_is_virtual",this.variable_is_virtual).on("change","input.variable_manage_stock",this.variable_manage_stock).on("click","button.notice-dismiss",this.notice_dismiss).on("click","h3 .sort",this.set_menu_order).on("click","button.add_price_for_variations",this.open_modal_to_set_variations_price).on("reload",this.reload).on("click","button.create-variations",this.create_variations),a("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").trigger("change"),a("#fincommerce-product-data").on("fincommerce_variations_loaded",this.variations_loaded),a(document.body).on("keyup",".wc_input_variations_price",this.maybe_enable_button_to_add_price_to_variations),a(document.body).on("input",".variation-cost-field",this.show_or_hide_cost_description),a(document).on("click","a.switch-to-general-tab",this.switch_to_general_tab)},create_variations:function(i){if(a(this).hasClass("disabled"))i.preventDefault();else{var e=a(".fincommerce_variation_new_attribute_data");a("#variable_product_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t=e.find("input, select, textarea"),n={post_id:fincommerce_admin_meta_boxes.post_id,product_type:a("#product-type").val(),data:t.serialize(),action:"fincommerce_add_attributes_and_variations",security:fincommerce_admin_meta_boxes.add_attributes_and_variations};a.post(fincommerce_admin_meta_boxes.ajax_url,n,function(i){if(i.error)window.alert(i.error),a("#variable_product_options").unblock();else if(i){var e=window.location.toString();e=e.replace("post-new.php?","post.php?post="+fincommerce_admin_meta_boxes.post_id+"&action=edit&"),a.get(e,function(i){a("#variable_product_options").unblock(),a("#variable_product_options_inner").replaceWith(a(i).find("#variable_product_options_inner")),a("#variable_product_options").trigger("reload"),a("#product_attributes > .product_attributes").replaceWith(a(i).find("#product_attributes > .product_attributes"))})}})}},reload:function(){t.load_variations(1).then(t.show_hide_variation_empty_state),n.set_paginav(0)},variable_is_downloadable:function(){a(this).closest(".fincommerce_variation").find(".show_if_variation_downloadable").hide(),a(this).is(":checked")&&a(this).closest(".fincommerce_variation").find(".show_if_variation_downloadable").show()},variable_is_virtual:function(){a(this).closest(".fincommerce_variation").find(".hide_if_variation_virtual").show(),a(this).is(":checked")&&a(this).closest(".fincommerce_variation").find(".hide_if_variation_virtual").hide()},maybe_enable_button_to_add_price_to_variations:function(){var i=parseInt(a(".wc_input_variations_price").val(),10);isNaN(i)?a(".add_variations_price_button").prop("disabled",!0):a(".add_variations_price_button").prop("disabled",!1)},show_or_hide_cost_description:function(i){const e=a(i.currentTarget);""===e.find("input").val()?e.find(".description").show():e.find(".description").hide()},switch_to_general_tab:function(i){return i.preventDefault(),a(".product_data_tabs .general_tab a").trigger("click"),!1},variable_manage_stock:function(){a(this).closest(".fincommerce_variation").find(".show_if_variation_manage_stock").hide(),a(this).closest(".fincommerce_variation").find(".variable_stock_status").show(),a(this).is(":checked")&&(a(this).closest(".fincommerce_variation").find(".show_if_variation_manage_stock").show(),a(this).closest(".fincommerce_variation").find(".variable_stock_status").hide()),a("input#_manage_stock:checked").length&&a(this).closest(".fincommerce_variation").find(".variable_stock_status").hide()},notice_dismiss:function(){a(this).closest("div.notice").remove()},variations_loaded:function(e,t){t=t||!1;var n=a("#fincommerce-product-data");t||(a("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock",n).trigger("change"),a(".fincommerce_variation",n).each(function(i,e){var t=a(e),n=a(".sale_price_dates_from",t).val(),o=a(".sale_price_dates_to",t).val();""===n&&""===o||a("a.sale_schedule",t).trigger("click")}),a(".fincommerce_variations .variation-needs-update",n).removeClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes",n).attr("disabled","disabled")),a("#tiptip_holder").removeAttr("style"),a("#tiptip_arrow").removeAttr("style"),a(".fincommerce_variations .tips, .fincommerce_variations .help_tip, .fincommerce_variations .fincommerce-help-tip, .toolbar-variations-defaults .fincommerce-help-tip",n).tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),a(".sale_price_dates_fields",n).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(){var i=a(this).is(".sale_price_dates_from")?"minDate":"maxDate",e=a(this).closest(".sale_price_dates_fields").find("input"),t=a(this).datepicker("getDate");e.not(this).datepicker("option",i,t),a(this).trigger("change")}}),a(".fincommerce_variations",n).sortable({items:".fincommerce_variation",cursor:"move",axis:"y",handle:".sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(){i.variation_row_indexes()}}),a(document.body).trigger("wc-enhanced-select-init")},set_variations_price:function(){var i=a(".wc_input_variations_price").val(),e=a("select#product-type").val();a(`.wc_input_price[name^=${"variable-subscription"===e?"variable_subscription_sign_up_fee":"variable_regular_price"}]`).each(function(e,t){"0"!==a(t).val()&&""!==a(t).val()||a(t).val(i).trigger("change")}),t.save_variations()},open_modal_to_set_variations_price:function(){a(this).WCBackboneModal({template:"wc-modal-set-price-variations"}),a(".add_variations_price_button").on("click",i.set_variations_price)},set_menu_order:function(i){i.preventDefault();var e=a(this).closest(".fincommerce_variation").find(".variation_menu_order"),n=a(this).closest(".fincommerce_variation").find(".variable_post_id").val(),o=window.prompt(fincommerce_admin_meta_boxes_variations.i18n_enter_menu_order,e.val());null!=o&&(e.val(parseInt(o,10)).trigger("change"),a(this).closest(".fincommerce_variation").append('<input type="hidden" name="new_variation_menu_order_id" value="'+encodeURIComponent(n)+'" />'),a(this).closest(".fincommerce_variation").append('<input type="hidden" name="new_variation_menu_order_value" value="'+encodeURIComponent(parseInt(o,10))+'" />'),t.save_variations())},variation_row_indexes:function(){var i=a("#variable_product_options").find(".fincommerce_variations"),e=parseInt(i.attr("data-page"),10),t=parseInt((e-1)*fincommerce_admin_meta_boxes_variations.variations_per_page,10);a(".fincommerce_variations .fincommerce_variation").each(function(i,e){a(".variation_menu_order",e).val(parseInt(a(e).index(".fincommerce_variations .fincommerce_variation"),10)+1+t).trigger("change")})}},e={variable_image_frame:null,setting_variation_image_id:null,setting_variation_image:null,wp_media_post_id:wp.media.model.settings.post.id,init:function(){a("#variable_product_options").on("click",".upload_image_button",this.add_image),a("a.add_media").on("click",this.restore_wp_media_post_id)},add_image:function(i){var t=a(this),n=t.attr("rel"),o=t.closest(".upload_image");if(e.setting_variation_image=o,e.setting_variation_image_id=n,i.preventDefault(),t.is(".remove"))a(".upload_image_id",e.setting_variation_image).val("").trigger("change"),e.setting_variation_image.find("img").eq(0).attr("src",fincommerce_admin_meta_boxes_variations.fincommerce_placeholder_img_src),e.setting_variation_image.find(".upload_image_button").removeClass("remove");else{if(e.variable_image_frame)return e.variable_image_frame.uploader.uploader.param("post_id",e.setting_variation_image_id),void e.variable_image_frame.open();wp.media.model.settings.post.id=e.setting_variation_image_id,e.variable_image_frame=wp.media.frames.variable_image=wp.media({title:fincommerce_admin_meta_boxes_variations.i18n_choose_image,button:{text:fincommerce_admin_meta_boxes_variations.i18n_set_image},states:[new wp.media.controller.Library({title:fincommerce_admin_meta_boxes_variations.i18n_choose_image,filterable:"all"})]}),e.variable_image_frame.on("select",function(){var i=e.variable_image_frame.state().get("selection").first().toJSON(),t=i.sizes&&i.sizes.thumbnail?i.sizes.thumbnail.url:i.url;a(".upload_image_id",e.setting_variation_image).val(i.id).trigger("change"),e.setting_variation_image.find(".upload_image_button").addClass("remove"),e.setting_variation_image.find("img").eq(0).attr("src",t),wp.media.model.settings.post.id=e.wp_media_post_id}),e.variable_image_frame.open()}},restore_wp_media_post_id:function(){wp.media.model.settings.post.id=e.wp_media_post_id}},t={init:function(){a("li.variations_tab a").on("click",this.initial_load),a("#variable_product_options").on("click","button.save-variation-changes",this.save_variations).on("click","button.cancel-variation-changes",this.cancel_variations).on("click",".remove_variation",this.remove_variation).on("click",".downloadable_files a.delete",this.input_changed),a(document.body).on("change input","#variable_product_options .fincommerce_variations :input",this.input_changed).on("change",".variations-defaults select",this.defaults_changed);var i=a("form#post");i.on("submit",this.save_on_submit),a("input:submit",i).on("click keypress",function(){i.data("callerid",this.id)}),a(".wc-metaboxes-wrapper").on("change","#field_to_edit",this.do_variation_action),a(".wc-metaboxes-wrapper").on("click","button.generate_variations",this.generate_variations),a(".wc-metaboxes-wrapper").on("click","button.add_variation_manually",this.add_variation_manually)},check_for_changes:function(){var i=a("#variable_product_options").find(".fincommerce_variations .variation-needs-update");if(0<i.length){if(!window.confirm(fincommerce_admin_meta_boxes_variations.i18n_edited_variations))return i.removeClass("variation-needs-update"),!1;t.save_changes()}return!0},block:function(){a("#fincommerce-product-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#fincommerce-product-data").unblock()},initial_load:function(){0===a("#variable_product_options").find(".fincommerce_variations .fincommerce_variation").length&&n.go_to_page()},load_variations:function(i,e){return new Promise((n,o)=>{i=i||1,e=e||fincommerce_admin_meta_boxes_variations.variations_per_page;var r=a("#variable_product_options").find(".fincommerce_variations");t.block(),a.ajax({url:fincommerce_admin_meta_boxes_variations.ajax_url,data:{action:"fincommerce_load_variations",security:fincommerce_admin_meta_boxes_variations.load_variations_nonce,product_id:fincommerce_admin_meta_boxes_variations.post_id,attributes:r.data("attributes"),page:i,per_page:e},type:"POST",success:function(e){r.empty().append(e).attr("data-page",i),a("#fincommerce-product-data").trigger("fincommerce_variations_loaded"),t.unblock(),n(e)},error:function(a,i,e){t.unblock(),o({jqXHR:a,textStatus:i,errorThrown:e})}})})},get_variations_fields:function(i){var e=a(":input",i).serializeJSON();return a(".variations-defaults select").each(function(i,t){var n=a(t);e[n.attr("name")]=n.val()}),e},save_changes:function(i){var e=a("#variable_product_options").find(".fincommerce_variations"),n=a(".variation-needs-update",e),o={};0<n.length&&(t.block(),(o=t.get_variations_fields(n)).action="fincommerce_save_variations",o.security=fincommerce_admin_meta_boxes_variations.save_variations_nonce,o.product_id=fincommerce_admin_meta_boxes_variations.post_id,o["product-type"]=a("#product-type").val(),a.ajax({url:fincommerce_admin_meta_boxes_variations.ajax_url,data:o,type:"POST",success:function(e){n.removeClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes").attr("disabled","disabled"),a("#fincommerce-product-data").trigger("fincommerce_variations_saved"),"function"==typeof i&&i(e),t.unblock()}}))},save_variations:function(){return a("#variable_product_options").trigger("fincommerce_variations_save_variations_button"),t.save_changes(function(i){var e=a("#variable_product_options").find(".fincommerce_variations"),t=e.attr("data-page");a("#variable_product_options").find("#fincommerce_errors").remove(),i&&e.before(i),a(".variations-defaults select").each(function(){a(this).attr("data-current",a(this).val())}),n.go_to_page(t)}),!1},save_on_submit:function(i){0<a("#variable_product_options").find(".fincommerce_variations .variation-needs-update").length&&(i.preventDefault(),a("#variable_product_options").trigger("fincommerce_variations_save_variations_on_submit"),t.save_changes(t.save_on_submit_done))},save_on_submit_done:function(){var i=a("form#post");"publish"===i.data("callerid")?i.append('<input type="hidden" name="publish" value="1" />').trigger("submit"):i.append('<input type="hidden" name="save-post" value="1" />').trigger("submit")},cancel_variations:function(){var i=parseInt(a("#variable_product_options").find(".fincommerce_variations").attr("data-page"),10);return a("#variable_product_options").find(".fincommerce_variations .variation-needs-update").removeClass("variation-needs-update"),a(".variations-defaults select").each(function(){a(this).val(a(this).attr("data-current"))}),n.go_to_page(i),!1},add_variation:function(){t.block();var e={action:"fincommerce_add_variation",post_id:fincommerce_admin_meta_boxes_variations.post_id,loop:a(".fincommerce_variation").length,security:fincommerce_admin_meta_boxes_variations.add_variation_nonce};return a.post(fincommerce_admin_meta_boxes_variations.ajax_url,e,function(e){var o=a(e);o.addClass("variation-needs-update"),a(".fincommerce-notice-invalid-variation").remove(),a("#variable_product_options").find(".fincommerce_variations").prepend(o),a("button.cancel-variation-changes, button.save-variation-changes").prop("disabled",!1),n.update_single_quantity(),i.variations_loaded(null,!0),t.show_hide_variation_empty_state(),a("#variable_product_options").trigger("fincommerce_variations_added",1),t.unblock()}),!1},remove_variation:function(){if(t.check_for_changes(),window.confirm(fincommerce_admin_meta_boxes_variations.i18n_remove_variation)){var i=a(this).attr("rel"),e=[],o={action:"fincommerce_remove_variations"};t.block(),0<i?(e.push(i),o.variation_ids=e,o.security=fincommerce_admin_meta_boxes_variations.delete_variations_nonce,a.post(fincommerce_admin_meta_boxes_variations.ajax_url,o,function(){var i=a("#variable_product_options").find(".fincommerce_variations"),e=parseInt(i.attr("data-page"),10),t=Math.ceil((parseInt(i.attr("data-total"),10)-1)/fincommerce_admin_meta_boxes_variations.variations_per_page),o=1;a("#fincommerce-product-data").trigger("fincommerce_variations_removed"),e===t||e<=t?o=e:e>t&&0!==t&&(o=t),0===t&&a(".generate_variations").text("Generate variations"),n.go_to_page(o,-1)})):t.unblock(),window.wcTracks.recordEvent("product_variations_buttons",{action:"remove_variation"})}return!1},link_all_variations:function(){if(t.check_for_changes(),window.confirm(fincommerce_admin_meta_boxes_variations.i18n_link_all_variations)){t.block();var i={action:"fincommerce_link_all_variations",post_id:fincommerce_admin_meta_boxes_variations.post_id,security:fincommerce_admin_meta_boxes_variations.link_variation_nonce};a.post(fincommerce_admin_meta_boxes_variations.ajax_url,i,function(i){const e=parseInt(i,10)||0,o=1===e?fincommerce_admin_meta_boxes_variations.i18n_variation_added:fincommerce_admin_meta_boxes_variations.i18n_variations_added.replace("%qty%",e);window.wp.data.dispatch("core/notices").createSuccessNotice(o,{icon:"🎉"}),t.show_hide_variation_empty_state(),e>0?(n.go_to_page(1,e),a(".generate_variations").text("Regenerate variations")):t.unblock()}),window.wcTracks.recordEvent("product_variations_buttons",{action:"generate_variations"})}return!1},input_changed:function(i){a(this).closest(".fincommerce_variation").addClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes").prop("disabled",!1),"input"===i.type&&a(this).is(":text")||a("#variable_product_options").trigger("fincommerce_variations_input_changed")},defaults_changed:function(){a(this).closest("#variable_product_options").find(".fincommerce_variation:first").addClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes").prop("disabled",!1),a("#variable_product_options").trigger("fincommerce_variations_defaults_changed")},do_variation_action:function(){var i,e=a(this).val(),o={},r=0,_=!1;switch(e){case"delete_all":window.confirm(fincommerce_admin_meta_boxes_variations.i18n_delete_all_variations)&&window.confirm(fincommerce_admin_meta_boxes_variations.i18n_last_warning)&&(o.allowed=!0,r=-1*parseInt(a("#variable_product_options").find(".fincommerce_variations").attr("data-total"),10));break;case"variable_regular_price_increase":case"variable_regular_price_decrease":case"variable_sale_price_increase":case"variable_sale_price_decrease":let t=fincommerce_admin_meta_boxes_variations.i18n_enter_a_value_fixed_or_percent;"variable_regular_price_decrease"!==e&&"variable_sale_price_increase"!==e||(t+="\n\n"+fincommerce_admin_meta_boxes_variations.i18n_sale_price_warning),null!=(i=window.prompt(t))?i.indexOf("%")>=0?o.value=accounting.unformat(i.replace(/\%/,""),fincommerce_admin.mon_decimal_point)+"%":o.value=accounting.unformat(i,fincommerce_admin.mon_decimal_point):_=!0;break;case"variable_regular_price":case"variable_sale_price":case"variable_stock":case"variable_low_stock_amount":case"variable_weight":case"variable_length":case"variable_width":case"variable_height":case"variable_download_limit":case"variable_download_expiry":null!=(i=window.prompt(fincommerce_admin_meta_boxes_variations.i18n_enter_a_value))?o.value=i:_=!0;break;case"variable_unset_cogs_value":window.confirm(fincommerce_admin_meta_boxes_variations.i18n_variation_cost_remove_warning)||(_=!0);break;case"variable_sale_schedule":o.date_from=window.prompt(fincommerce_admin_meta_boxes_variations.i18n_scheduled_sale_start),o.date_to=window.prompt(fincommerce_admin_meta_boxes_variations.i18n_scheduled_sale_end),null===o.date_from&&(o.date_from=!1),null===o.date_to&&(o.date_to=!1),!1===o.date_to&&!1===o.date_from&&(_=!0);break;default:a("select.variation_actions").trigger(e),null===(o=a("select.variation_actions").triggerHandler(e+"_ajax_data",o))&&(_=!0)}_?a("#field_to_edit").val("bulk_actions"):("delete_all"===e&&o.allowed?(a("#variable_product_options").find(".variation-needs-update").removeClass("variation-needs-update"),a(".generate_variations").text("Generate variations")):t.check_for_changes(),t.block(),a.ajax({url:fincommerce_admin_meta_boxes_variations.ajax_url,data:{action:"fincommerce_bulk_edit_variations",security:fincommerce_admin_meta_boxes_variations.bulk_edit_variations_nonce,product_id:fincommerce_admin_meta_boxes_variations.post_id,product_type:a("#product-type").val(),bulk_action:e,data:o},type:"POST",success:function(){n.go_to_page(1,r)},complete:function(){a("#field_to_edit").val("bulk_actions")}}))},show_hide_variation_empty_state:function(){var i=a("#variable_product_options").find(".fincommerce_variations");parseInt(i.attr("data-total"))>0?(a("#variable_product_options_inner").removeClass("no-variations"),a("#field_to_edit").removeClass("hidden")):(a("#variable_product_options_inner").addClass("no-variations"),a("#field_to_edit").addClass("hidden"))},generate_variations:function(){t.link_all_variations()},add_variation_manually:function(){t.add_variation()}},n={init:function(){a(document.body).on("change",".variations-pagenav .page-selector",this.page_selector).on("click",".variations-pagenav .first-page",this.first_page).on("click",".variations-pagenav .prev-page",this.prev_page).on("click",".variations-pagenav .next-page",this.next_page).on("click",".variations-pagenav .last-page",this.last_page)},update_variations_count:function(i){var e=a("#variable_product_options").find(".fincommerce_variations"),t=parseInt(e.attr("data-total"),10)+i,n=a(".variations-pagenav .displaying-num");e.attr("data-total",t);const o=1===t?fincommerce_admin_meta_boxes_variations.i18n_variation_count_single:fincommerce_admin_meta_boxes_variations.i18n_variation_count_plural.replace("%qty%",t);return n.text(o),t},update_single_quantity:function(){n.update_variations_count(1);const i=a(".variations-pagenav");i.is(":hidden")&&(a("option, optgroup",".variation_actions").show(),a(".variation_actions").val("bulk_actions"),a("#variable_product_options").find(".toolbar").show(),i.show(),a(".pagination-links",i).hide())},set_paginav:function(i){var e=a("#variable_product_options").find(".fincommerce_variations"),t=n.update_variations_count(i),o=a("#variable_product_options").find(".toolbar"),r=a(".variation_actions"),_=a(".variations-pagenav"),s=a(".pagination-links",_),c=Math.ceil(t/fincommerce_admin_meta_boxes_variations.variations_per_page),d="";e.attr("data-total_pages",c),a(".total-pages",_).text(c);for(var l=1;l<=c;l++)d+='<option value="'+l+'">'+l+"</option>";a(".page-selector",_).empty().html(d),0===t?(o.not(".toolbar-top, .toolbar-buttons").hide(),_.hide(),a("option, optgroup",r).hide(),a(".variation_actions").val("bulk_actions"),a('option[data-global="true"]',r).show()):(o.show(),_.show(),a("option, optgroup",r).show(),a(".variation_actions").val("bulk_actions"),1===c?s.hide():s.show())},check_is_enabled:function(i){return!a(i).hasClass("disabled")},change_classes:function(i,e){var t=a(".variations-pagenav .first-page"),n=a(".variations-pagenav .prev-page"),o=a(".variations-pagenav .next-page"),r=a(".variations-pagenav .last-page");1===i?(t.addClass("disabled"),n.addClass("disabled")):(t.removeClass("disabled"),n.removeClass("disabled")),e===i?(o.addClass("disabled"),r.addClass("disabled")):(o.removeClass("disabled"),r.removeClass("disabled"))},set_page:function(i){a(".variations-pagenav .page-selector").val(i).first().trigger("change")},go_to_page:function(a,i){a=a||1,i=i||0,n.set_paginav(i),n.set_page(a)},page_selector:function(){var i=parseInt(a(this).val(),10),e=a("#variable_product_options").find(".fincommerce_variations");a(".variations-pagenav .page-selector").val(i),t.check_for_changes(),n.change_classes(i,parseInt(e.attr("data-total_pages"),10)),t.load_variations(i).then(t.show_hide_variation_empty_state())},first_page:function(){return n.check_is_enabled(this)&&n.set_page(1),!1},prev_page:function(){if(n.check_is_enabled(this)){var i=a("#variable_product_options").find(".fincommerce_variations"),e=parseInt(i.attr("data-page"),10)-1,t=0<e?e:1;n.set_page(t)}return!1},next_page:function(){if(n.check_is_enabled(this)){var i=a("#variable_product_options").find(".fincommerce_variations"),e=parseInt(i.attr("data-total_pages"),10),t=parseInt(i.attr("data-page"),10)+1,o=e>=t?t:e;n.set_page(o)}return!1},last_page:function(){if(n.check_is_enabled(this)){var i=a("#variable_product_options").find(".fincommerce_variations").attr("data-total_pages");n.set_page(i)}return!1}};i.init(),e.init(),t.init(),n.init()});