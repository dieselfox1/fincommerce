!function(e,r){var t=function(e){this.$form=e,this.xhr=!1,this.$form.find(".fincommerce-exporter-progress").val(0),this.processStep=this.processStep.bind(this),e.on("submit",{productExportForm:this},this.onSubmit),e.find(".fincommerce-exporter-types").on("change",{productExportForm:this},this.exportTypeFields)};t.prototype.onSubmit=function(r){r.preventDefault();var t=new Date,o="wc-product-export-"+t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear()+"-"+t.getTime()+".csv";r.data.productExportForm.$form.addClass("fincommerce-exporter__exporting"),r.data.productExportForm.$form.find(".fincommerce-exporter-progress").val(0),r.data.productExportForm.$form.find(".fincommerce-exporter-button").prop("disabled",!0),r.data.productExportForm.processStep(1,e(this).serialize(),"",o)},t.prototype.processStep=function(t,o,c,p){var n=this,i=e(".fincommerce-exporter-columns").val(),a=e("#fincommerce-exporter-meta:checked").length?1:0,s=e(".fincommerce-exporter-types").val(),m=e(".fincommerce-exporter-category").val(),d=n.$form.find('input[name="product_ids"]').val()||"";e.ajax({type:"POST",url:ajaxurl,data:{form:o,action:"fincommerce_do_ajax_product_export",step:t,columns:c,selected_columns:i,export_meta:a,export_types:s,export_category:m,export_product_ids:d,filename:p,security:wc_product_export_params.export_nonce},dataType:"json",success:function(e){e.success&&("done"===e.data.step?(n.$form.find(".fincommerce-exporter-progress").val(e.data.percentage),r.location=e.data.url,setTimeout(function(){n.$form.removeClass("fincommerce-exporter__exporting"),n.$form.find(".fincommerce-exporter-button").prop("disabled",!1)},2e3)):(n.$form.find(".fincommerce-exporter-progress").val(e.data.percentage),n.processStep(parseInt(e.data.step,10),o,e.data.columns,p)))}}).fail(function(e){r.console.log(e)})},t.prototype.exportTypeFields=function(){var r=e(".fincommerce-exporter-category");-1!==e.inArray("variation",e(this).val())?(r.closest("tr").hide(),r.val("").trigger("change")):r.closest("tr").show()},e.fn.wc_product_export_form=function(){return new t(this),this},e(".fincommerce-exporter").wc_product_export_form()}(jQuery,window);